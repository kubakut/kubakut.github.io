L.Control.GroupedLayers=L.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(t,e,o){L.Util.setOptions(this,o),this._layers={},this._lastZIndex=0,this._handlingClick=!1,this._groupList=[],this._domGroups=[];for(var i in t)this._addLayer(t[i],i);for(i in e)for(j in e[i])this._addLayer(e[i][j],j,i,!0)},onAdd:function(t){return this._initLayout(),this._update(),t.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(t){t.off("layeradd",this._onLayerChange).off("layerremove",this._onLayerChange)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._update(),this},addOverlay:function(t,e,o){return this._addLayer(t,e,o,!0),this._update(),this},removeLayer:function(t){var e=L.Util.stamp(t);return delete this._layers[e],this._update(),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=L.DomUtil.create("div",t);e.setAttribute("aria-haspopup",!0),L.Browser.touch?L.DomEvent.on(e,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(e),L.DomEvent.on(e,"wheel",L.DomEvent.stopPropagation));var o=this._form=L.DomUtil.create("form",t+"-list");if(this.options.collapsed){L.Browser.android||L.DomEvent.on(e,"mouseover",this._expand,this).on(e,"mouseout",this._collapse,this);var i=this._layersLink=L.DomUtil.create("a",t+"-toggle",e);i.href="#",i.title="Layers",L.Browser.touch?L.DomEvent.on(i,"click",L.DomEvent.stop).on(i,"click",this._expand,this):L.DomEvent.on(i,"focus",this._expand,this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=L.DomUtil.create("div",t+"-base",o),this._separator=L.DomUtil.create("div",t+"-separator",o),this._overlaysList=L.DomUtil.create("div",t+"-overlays",o),e.appendChild(o)},_addLayer:function(t,e,o,i){var n=L.Util.stamp(t);if(this._layers[n]={layer:t,name:e,overlay:i},o){var a=this._groupList.indexOf(o);-1===a&&(a=this._groupList.push(o)-1),this._layers[n].group={name:o,id:a}}this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="",this._domGroups.length=0;var o,i,t=!1,e=!1;for(o in this._layers)i=this._layers[o],this._addItem(i),e=e||i.overlay,t=t||!i.overlay;this._separator.style.display=e&&t?"":"none"}},_onLayerChange:function(t){var e=this._layers[L.Util.stamp(t.layer)];if(e){this._handlingClick||this._update();var o=e.overlay?"layeradd"===t.type?"overlayadd":"overlayremove":"layeradd"===t.type?"baselayerchange":null;o&&this._map.fire(o,e)}},_createRadioElement:function(t,e){var o='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"';e&&(o+=' checked="checked"'),o+="/>";var i=document.createElement("div");return i.innerHTML=o,i.firstChild},_addItem:function(t){var o,e=document.createElement("label"),i=this._map.hasLayer(t.layer);t.overlay?(o=document.createElement("input"),o.type="checkbox",o.className="leaflet-control-layers-selector",o.defaultChecked=i):o=this._createRadioElement("leaflet-base-layers",i),o.layerId=L.Util.stamp(t.layer),L.DomEvent.on(o,"click",this._onInputClick,this);var n=document.createElement("span");if(n.innerHTML=" "+t.name,e.appendChild(o),e.appendChild(n),t.overlay){container=this._overlaysList;var a=this._domGroups[t.group.id];if(!a){a=document.createElement("div"),a.className="leaflet-control-layers-group",a.id="leaflet-control-layers-group-"+t.group.id;var s=document.createElement("span");s.className="leaflet-control-layers-group-name",s.innerHTML=t.group.name,a.appendChild(s),container.appendChild(a),this._domGroups[t.group.id]=a}container=a}else container=this._baseLayersList;return container.appendChild(e),e},_onInputClick:function(){var t,e,o,i=this._form.getElementsByTagName("input"),n=i.length;for(this._handlingClick=!0,t=0;n>t;t++)e=i[t],o=this._layers[e.layerId],e.checked&&!this._map.hasLayer(o.layer)?this._map.addLayer(o.layer):!e.checked&&this._map.hasLayer(o.layer)&&this._map.removeLayer(o.layer);this._handlingClick=!1},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),L.control.groupedLayers=function(t,e,o){return new L.Control.GroupedLayers(t,e,o)};